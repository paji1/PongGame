import { useState } from "react";
import { toast } from "react-toastify";
import { ip } from "../network/ipaddr";
import { Label } from "recharts";

export const UploadTest = () => {
	const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
		const types = ["image/png", "image/gif", "image/jpg", "image/jpeg"];
		if (e.target.files) {
			if (!types.includes(e.target.files[0].type)) {
				toast.error("Error: png, jpg or jpeg  are the accepted types");
				return;
			}
			if (e.target.files[0].size > 5000000) {
				toast.error("ile bigger than 5Mb in size");
				return;
			}
			handleUpload(e.target.files[0]);
		}
	};

	const handleUpload = (file: File) => {
		if (!file) {
			toast.error("please chose  an image");
			return;
		}
		var formdata = new FormData();
		formdata.append("IMAGE", file);
		fetch("http://" + ip + "3001/repository", { body: formdata, method: "POST", credentials: "include" }).then(
			async (res) => {
				if (res.status < 400) {
					toast("image uploaded succesfully");
					return;
				}
				const ret = await res.json();
				toast.error(ret.message);
			}
		);
	};

	return (
			<label className="absolute w-[5%] h-[4%] cursor-pointer">
				<input type="file" className="hidden" onChange={handleFileChange} />
				<svg
						className="absolute ml-4 m-2 p-1"
						width="40"
						height="40"
						viewBox="0 0 22 20"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M19 8.5C18.7348 8.5 18.4804 8.60536 18.2929 8.79289C18.1054 8.98043 18 9.23478 18 9.5V16.5C18 16.7652 17.8946 17.0196 17.7071 17.2071C17.5196 17.3946 17.2652 17.5 17 17.5H3C2.73478 17.5 2.48043 17.3946 2.29289 17.2071C2.10536 17.0196 2 16.7652 2 16.5V8.5C2 8.23478 2.10536 7.98043 2.29289 7.79289C2.48043 7.60536 2.73478 7.5 3 7.5H5C5.21807 7.51138 5.43386 7.45107 5.61443 7.32829C5.795 7.2055 5.93042 7.02698 6 6.82L6.54 5.18C6.60709 4.98138 6.7349 4.80886 6.90537 4.68684C7.07584 4.56482 7.28036 4.49946 7.49 4.5H13C13.2652 4.5 13.5196 4.39464 13.7071 4.20711C13.8946 4.01957 14 3.76522 14 3.5C14 3.23478 13.8946 2.98043 13.7071 2.79289C13.5196 2.60536 13.2652 2.5 13 2.5H7.44C6.81155 2.50118 6.19933 2.69968 5.68977 3.06751C5.1802 3.43533 4.79901 3.95389 4.6 4.55L4.28 5.55H3C2.20435 5.55 1.44129 5.86607 0.87868 6.42868C0.31607 6.99129 0 7.75435 0 8.55V16.55C0 17.3456 0.31607 18.1087 0.87868 18.6713C1.44129 19.2339 2.20435 19.55 3 19.55H17C17.7956 19.55 18.5587 19.2339 19.1213 18.6713C19.6839 18.1087 20 17.3456 20 16.55V9.55C20.0068 9.41453 19.9859 9.2791 19.9387 9.15194C19.8915 9.02479 19.8189 8.90856 19.7254 8.81034C19.6318 8.71212 19.5193 8.63396 19.3946 8.58061C19.2699 8.52726 19.1356 8.49983 19 8.5ZM10 7.5C9.20887 7.5 8.43552 7.7346 7.77772 8.17412C7.11992 8.61365 6.60723 9.23836 6.30448 9.96927C6.00173 10.7002 5.92252 11.5044 6.07686 12.2804C6.2312 13.0563 6.61216 13.769 7.17157 14.3284C7.73098 14.8878 8.44371 15.2688 9.21964 15.4231C9.99556 15.5775 10.7998 15.4983 11.5307 15.1955C12.2616 14.8928 12.8864 14.3801 13.3259 13.7223C13.7654 13.0645 14 12.2911 14 11.5C14 10.4391 13.5786 9.42172 12.8284 8.67157C12.0783 7.92143 11.0609 7.5 10 7.5ZM10 13.5C9.60444 13.5 9.21776 13.3827 8.88886 13.1629C8.55996 12.9432 8.30362 12.6308 8.15224 12.2654C8.00087 11.8999 7.96126 11.4978 8.03843 11.1098C8.1156 10.7219 8.30608 10.3655 8.58579 10.0858C8.86549 9.80608 9.22186 9.6156 9.60982 9.53843C9.99778 9.46126 10.3999 9.50087 10.7654 9.65224C11.1308 9.80362 11.4432 10.06 11.6629 10.3889C11.8827 10.7178 12 11.1044 12 11.5C12 12.0304 11.7893 12.5391 11.4142 12.9142C11.0391 13.2893 10.5304 13.5 10 13.5ZM21 2.5H20V1.5C20 1.23478 19.8946 0.98043 19.7071 0.792893C19.5196 0.605357 19.2652 0.5 19 0.5C18.7348 0.5 18.4804 0.605357 18.2929 0.792893C18.1054 0.98043 18 1.23478 18 1.5V2.5H17C16.7348 2.5 16.4804 2.60536 16.2929 2.79289C16.1054 2.98043 16 3.23478 16 3.5C16 3.76522 16.1054 4.01957 16.2929 4.20711C16.4804 4.39464 16.7348 4.5 17 4.5H18V5.5C18 5.76522 18.1054 6.01957 18.2929 6.20711C18.4804 6.39464 18.7348 6.5 19 6.5C19.2652 6.5 19.5196 6.39464 19.7071 6.20711C19.8946 6.01957 20 5.76522 20 5.5V4.5H21C21.2652 4.5 21.5196 4.39464 21.7071 4.20711C21.8946 4.01957 22 3.76522 22 3.5C22 3.23478 21.8946 2.98043 21.7071 2.79289C21.5196 2.60536 21.2652 2.5 21 2.5Z"
							fill="black"
						/>
					</svg>
			</label>
	);
};
